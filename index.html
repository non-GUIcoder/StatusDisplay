<!DOCTYPE html>
<html>
<title>Status Display Panel</title>

<head>
    <link rel="stylesheet" type="text/css" href="stylesheet.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>
    <div id="fullScreen">
        <h1 style="float: left;">Status Display Panel</h1>
        <button onclick="location.href = 'admin.html';" class="large" style="background-color: grey; float: right; ">Go to Control Panel</button>
        <div style="clear:both;"></div>
        <p>This is a display for a status, which is maintained remotely. </p>
        <button onclick="initialise()" class="large" style="background-color: blue;">Initialise Display Panel</button>
        <p>This is the frontend for the display. For the administrative control panel, go to <a href="admin.html">admin.html</a> instead.</p>
    </div>
    <div id="infoPanel" class="statusBox">
        <h1 id="statusDisplayTitle">Status:</h1>
        <h2 id="statusDisplay">empty</h2>
    </div>
</body>
<script src="noSleep.js"></script>
<script>
    // handles telemetry and displays the status
    var status = "noConnection";

    timerID = setInterval(getStatus, 5000);

    // Gets status upon page load
    getStatus();

    function initialise() {
        // Keeps the device awake
        var noSleep = new NoSleep();
        noSleep.enable();

        // Fullscreen the webpage
        var elem = document.getElementById("infoPanel");
        if (elem.requestFullscreen) {
            elem.requestFullscreen();
        } else if (elem.mozRequestFullScreen) { // Firefox
            elem.mozRequestFullScreen();
        } else if (elem.webkitRequestFullscreen) { // Chrome, Safari and Opera
            elem.webkitRequestFullscreen();
        } else if (elem.msRequestFullscreen) { // IE/Edge
            elem.msRequestFullscreen();
        }


    }

    function getStatus() {

        var httpGetStatus = new XMLHttpRequest();

        httpGetStatus.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                status = this.responseText.trim();
                setStatus();
            }
        };

        httpGetStatus.open("GET", "status.txt", true);
        httpGetStatus.send();

    }

    function setStatus() {
        // There are a number of pre-set statuses, which the style should react to:
        // idle, busy, occupied, debug;
        // which corresponds to the following messages:
        // come in without knocking, come in after knocking, do not knock, debug messages (e.g. check network).
        switch (status) {
            case "idle":
            case "busy":
            case "occupied":
            case "debug":
                document.getElementById("statusDisplay").innerHTML = status;
                document.getElementById("statusDisplay").className = status;
                document.getElementById("infoPanel").className = status;
                document.getElementById("statusDisplayTitle").className = status;
                break;

            default:
                document.getElementById("statusDisplay").innerHTML = status;
                document.getElementById("statusDisplay").className = "debug";
                document.getElementById("infoPanel").className = "debug";
                document.getElementById("statusDisplayTitle").className = "debug";

        }

    }
</script>

</html>